---
id: redis
slug: /deploying-addons/redis
title: Redis
---

To deploy a Redis instance on Porter, head to the **Community Add-ons** tab. You can optionally specify a password for the instance or configure the amount of resources (i.e. CPU and RAM) assigned to the instance.

![Redis settings](https://files.readme.io/3274ddb-Screen_Shot_2021-03-19_at_12.26.26_PM.png "Screen Shot 2021-03-19 at 12.26.26 PM.png")

## Connecting to the Database

Redis on Porter is by default only exposed to internal traffic - only applications and add-on's that are deployed in the same Kubernetes cluster can connect to the Redis instance. The DNS name for the instance can be found on the deployment view as shown below. Note that Redis listens on port 6379 by default.

![Redis URI](https://files.readme.io/d0d7317-Screen_Shot_2021-03-19_at_12.27.42_PM.png "Screen Shot 2021-03-19 at 12.27.42 PM.png")

The connection URI for the Redis instance follows this format:

```
redis://${DNS_NAME}:6379
```

If you've enabled password, the connection string would look like:

```
redis://${ARBITRARY_USERNAME}:${PASSWORD}@${DNA_NAME}:6379
```

You can pass in any string as your username (even an empty string). Redis does not support users but implements this behavior to comply with [URI RFC standard](https://tools.ietf.org/html/rfc3986).

For the example above that does not have password enabled, the connection string would be:

```
redis://peaches-redis-master.default.svc.cluster.local:6379
```

## Exposing Redis over NGINX

### Step 1: Install the Redis addon

![image](https://files.readme.io/0bca97e-redis.jpg)

### Step 2: Upgrade Redis to enable TLS and ingress

1. Upgrade the chart with the following values.

> ðŸš§
>
> **Warning:** make sure to merge these values with the existing values.

```yaml
# values.redis.yaml
auth:
  enabled: true
  # change the password here
  password: foo

tls:
  enabled: true
  authClients: false
  autoGenerated: true

ingress:
  enabled: true
  hosts:
    # change the domain here
    - example.com
```

> ðŸš§
>
> **Warning:** make sure to add an A record or CNAME record for your domain pointing to the cluster's load balancer IP address.

### Step 3: Upgrade NGINX Ingress Controller

Kubernetes Ingress does not support TCP services, so NGINX Ingress Controller needs to be [configured](https://kubernetes.github.io/ingress-nginx/user-guide/exposing-tcp-udp-services/) separately.

1. Upgrade the chart with the following values.

> ðŸš§
>
> **Warning:** make sure to merge these values with the existing values.

```yaml
# values.nginx.yaml
tcp:
  # service name is {release_name}-master
  6379: "default/hello-redis-world-master:6379"
  # {ingress_port}: {release_namespace}/{release_name}-master:{service_port}
```

### Step 4: Connect to Redis

1. Get the auto-generated CA certificate

   ```bash
   # secret name is {release_name}-crt
   $ kubectl get secret hello-redis-world-crt -o json |
       jq -r '.data."ca.crt"' |
       base64 --decode > ca.crt
   ```

2. Connect!

   ```bash
   # change the password and domain here
   $ redis-cli -u rediss://foo@example.com --cacert ./ca.crt
   ```
